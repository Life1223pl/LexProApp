{% extends 'base.html.twig' %}

{% block title %}Edytuj osobę{% endblock %}

{% block body %}
    <div class="container mt-4">

        <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
                <h1 class="mb-0">Edytuj osobę</h1>
                <div class="text-muted small">Zmień dane. Adresy są w sekcji poniżej.</div>
            </div>

            {% if postepowanieId %}
                <a class="btn btn-outline-secondary"
                   href="{{ path('app_postepowanie_osoby_index', { id: postepowanieId }) }}">← Wróć</a>
            {% else %}
                <a class="btn btn-outline-secondary" href="{{ path('app_osoba_index') }}">← Wróć</a>
            {% endif %}
        </div>

        <div class="card shadow-sm">
            <div class="card-body p-4">

                {{ form_start(form) }}

                {# ===== Dane podstawowe ===== #}
                <div class="mb-4">
                    <h5 class="mb-3">Dane podstawowe</h5>
                    <div class="row g-3">
                        <div class="col-md-4">{{ form_row(form.imie) }}</div>
                        <div class="col-md-4">{{ form_row(form.drugieImie) }}</div>
                        <div class="col-md-4">{{ form_row(form.nazwisko) }}</div>

                        <div class="col-md-4">{{ form_row(form.nazwiskoRodowe) }}</div>
                        <div class="col-md-4">{{ form_row(form.imieOjca) }}</div>
                        <div class="col-md-4">{{ form_row(form.imieMatki) }}</div>

                        <div class="col-md-4">{{ form_row(form.nazwiskoRodoweMatki) }}</div>
                        <div class="col-md-4">{{ form_row(form.plec) }}</div>
                        <div class="col-md-4">{{ form_row(form.dataUrodzenia) }}</div>

                        <div class="col-md-6">{{ form_row(form.miejsceUrodzenia) }}</div>
                    </div>
                </div>

                <hr class="my-4">

                {# ===== Identyfikacja ===== #}
                <div class="mb-4">
                    <h5 class="mb-3">Identyfikacja</h5>
                    <div class="row g-3">
                        <div class="col-md-4">{{ form_row(form.pesel) }}</div>
                        <div class="col-md-8">{{ form_row(form.numerDokumentu) }}</div>
                        <div class="col-md-4">{{ form_row(form.obywatelstwoGl) }}</div>
                        <div class="col-md-4">{{ form_row(form.obywatelstwoDodatkowe) }}</div>
                    </div>
                </div>

                <hr class="my-4">

                {# ===== Kontakt ===== #}
                <div class="mb-4">
                    <h5 class="mb-3">Kontakt</h5>
                    <div class="row g-3">
                        <div class="col-md-4">{{ form_row(form.telefon) }}</div>
                        <div class="col-md-8">{{ form_row(form.email) }}</div>
                    </div>
                </div>

                <hr class="my-4">

                {# ===== Adresy ===== #}
                <div class="mb-4">
                    <h5 class="mb-3">Adresy</h5>

                    <div class="card shadow-sm mb-3">
                        <div class="card-header bg-light"><strong>Adres zamieszkania</strong></div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-4">{{ form_row(form.adresZamieszkania.kraj) }}</div>
                                <div class="col-md-4">{{ form_row(form.adresZamieszkania.miejscowosc) }}</div>
                                <div class="col-md-4">{{ form_row(form.adresZamieszkania.kodPocztowy) }}</div>

                                <div class="col-md-6">{{ form_row(form.adresZamieszkania.ulica) }}</div>
                                <div class="col-md-3">{{ form_row(form.adresZamieszkania.nrDomu) }}</div>
                                <div class="col-md-3">{{ form_row(form.adresZamieszkania.nrLokalu) }}</div>
                            </div>
                            <div class="form-text mt-2">
                                Wymagane minimum: <strong>Miejscowość</strong> i <strong>Nr domu</strong>.
                            </div>
                        </div>
                    </div>

                    <div class="accordion" id="adresyAccordion">

                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingZameld">
                                <button class="accordion-button collapsed" type="button"
                                        data-bs-toggle="collapse" data-bs-target="#collapseZameld">
                                    Adres zameldowania (opcjonalnie)
                                </button>
                            </h2>
                            <div id="collapseZameld" class="accordion-collapse collapse" data-bs-parent="#adresyAccordion">
                                <div class="accordion-body">
                                    <div class="row g-3">
                                        <div class="col-md-4">{{ form_row(form.adresZameldowania.kraj) }}</div>
                                        <div class="col-md-4">{{ form_row(form.adresZameldowania.miejscowosc) }}</div>
                                        <div class="col-md-4">{{ form_row(form.adresZameldowania.kodPocztowy) }}</div>

                                        <div class="col-md-6">{{ form_row(form.adresZameldowania.ulica) }}</div>
                                        <div class="col-md-3">{{ form_row(form.adresZameldowania.nrDomu) }}</div>
                                        <div class="col-md-3">{{ form_row(form.adresZameldowania.nrLokalu) }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingKor">
                                <button class="accordion-button collapsed" type="button"
                                        data-bs-toggle="collapse" data-bs-target="#collapseKor">
                                    Adres korespondencyjny (opcjonalnie)
                                </button>
                            </h2>
                            <div id="collapseKor" class="accordion-collapse collapse" data-bs-parent="#adresyAccordion">
                                <div class="accordion-body">
                                    <div class="row g-3">
                                        <div class="col-md-4">{{ form_row(form.adresKorespondencyjny.kraj) }}</div>
                                        <div class="col-md-4">{{ form_row(form.adresKorespondencyjny.miejscowosc) }}</div>
                                        <div class="col-md-4">{{ form_row(form.adresKorespondencyjny.kodPocztowy) }}</div>

                                        <div class="col-md-6">{{ form_row(form.adresKorespondencyjny.ulica) }}</div>
                                        <div class="col-md-3">{{ form_row(form.adresKorespondencyjny.nrDomu) }}</div>
                                        <div class="col-md-3">{{ form_row(form.adresKorespondencyjny.nrLokalu) }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <hr class="my-4">

                {# ===== Dane dodatkowe ===== #}
                <div class="mb-4">
                    <h5 class="mb-3">Dane dodatkowe</h5>
                    <div class="row g-3">
                        <div class="col-md-4">{{ form_row(form.wyksztalcenie) }}</div>
                        <div class="col-md-4">{{ form_row(form.stanCywilny) }}</div>
                        <div class="col-md-4">{{ form_row(form.zawod) }}</div>

                        <div class="col-md-6">{{ form_row(form.miejscePracy) }}</div>
                        <div class="col-md-6">{{ form_row(form.stanowisko) }}</div>

                        <div class="col-12">{{ form_row(form.notatki) }}</div>
                    </div>
                </div>

                {# ✅ WAŻNE: resztę formularza (np. ukryty _token) renderujemy TU, przed przyciskami #}
                {{ form_rest(form) }}

                <div class="d-flex gap-2 pt-2">
                    <button class="btn btn-success px-4" type="submit">Zapisz</button>

                    {% if postepowanieId %}
                        <a class="btn btn-outline-secondary"
                           href="{{ path('app_postepowanie_osoby_index', { id: postepowanieId }) }}">Anuluj</a>
                    {% else %}
                        <a class="btn btn-outline-secondary" href="{{ path('app_osoba_index') }}">Anuluj</a>
                    {% endif %}
                </div>


                {{ form_end(form, { render_rest: false }) }}

            </div>
        </div>

    </div>
{% endblock %}
